<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Sudoku | a2.games</title>

    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        text-align: center;
        background-color: rgb(53, 120, 17);
        color: #333;
      }

      .screen {
        width: 90%;
        max-width: 500px;
        margin: 30px auto;
        padding: 25px;
        font-weight: 600;
        border-radius: 8px;
        background-color: #5ed674;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .screen h3,
      .screen h2 {
        margin-top: 0;
        font-size: 24px;
        color: #333;
      }

      .screen p {
        margin: 10px 0;
        line-height: 1.6;
        font-size: 16px;
      }

      .screen-btn {
        background-color: #5cb85c;
        color: white;
        border: none;
        padding: 12px 25px;
        font-size: 18px;
        font-weight: bold;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 15px;
        transition: background-color 0.3s;
      }

      .screen-btn:hover {
        background-color: #4cae4c;
      }

      #game-container {
        display: none;
      }
      #win-screen {
        display: none;
      }

      #errors {
        color: #d9534f;
        font-size: 24px;
        font-weight: bold;
      }

      #board {
        width: 90vw;
        max-width: 450px;
        margin: 15px auto;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        display: grid;
        grid-template-columns: repeat(9, 1fr);
        aspect-ratio: 1 / 1;
      }

      .tile {
        border: 1px solid #b0b0b0;
        font-size: 20px;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #fff;
        cursor: pointer;
      }

      #digits {
        width: 90vw;
        max-width: 450px;
        margin: 15px auto;
        display: flex;
        /* Use gap for spacing instead of margin */
        gap: 5px;
      }

      .number {
        /* Allow tiles to grow and shrink */
        flex: 1;
        aspect-ratio: 1 / 1; /* Keep them square */

        border: 1px solid black;
        font-size: 20px;
        font-weight: bold;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        border-radius: 5px;

        /* REMOVED fixed width, height, and margin */
      }

      .number-selected {
        background-color: #428bca;
        color: white;
      }
      .tile-start {
        background-color: #f0f0f0;
      }
      .horizontal-line {
        border-bottom: 2px solid black;
      }
      .vertical-line {
        border-right: 2px solid black;
      }

      .back-btn {
        background-color: #f0ad4e;
        margin-top: 0;
      }
      .back-btn:hover {
        background-color: #ec971f;
      }
    </style>
  </head>

  <body>
    <h1>Sudoku</h1>
    <hr style="width: 500px; border: 1px solid #ddd" />

    <div id="welcome-screen" class="screen">
      <h3>How to Play</h3>
      <p>1. Select a number from the palette below the board.</p>
      <p>2. Click an empty square on the board to place the number.</p>
      <p>3. Fill all empty squares correctly to win the game!</p>
      <button id="start-game-btn" class="screen-btn">Start Game</button>
    </div>

    <div id="game-container">
      <h2 id="errors">0</h2>
      <div id="board"></div>
      <div id="digits"></div>
      <button id="back-to-instructions-btn" class="screen-btn back-btn">
        Read Instructions
      </button>
    </div>

    <div id="win-screen" class="screen">
      <h2>Congratulations! ðŸ¥³</h2>
      <p>You have successfully solved the puzzle.</p>
      <button id="play-again-btn" class="screen-btn">Play Again</button>
      <a href="./index.html"
        ><button id="back" class="screen-btn">Back To Home Page</button></a
      >
    </div>

    <script>
      var numSelected = null;
      var errors = 0;
      var tilesToFill;
      var board;
      var solution;

      const puzzleData = [
        {
          board: [
            "--74916-5",
            "2---6-3-9",
            "-----7-1-",
            "-586----4",
            "--3----9-",
            "--62--187",
            "9-4-7---2",
            "67-83----",
            "81--45---",
          ],
          solution: [
            "387491625",
            "241568379",
            "569327418",
            "758619234",
            "123784596",
            "496253187",
            "934176852",
            "675832941",
            "812945763",
          ],
        },
        {
          board: [
            "53--7----",
            "6--195---",
            "-98----6-",
            "8---6---3",
            "4--8-3--1",
            "7---2---6",
            "-6----28-",
            "---419--5",
            "----8--79",
          ],
          solution: [
            "534678912",
            "672195348",
            "198342567",
            "859761423",
            "426853791",
            "713924856",
            "961537284",
            "287419635",
            "345286179",
          ],
        },
        {
          board: [
            "1--9-7-3-",
            "-8--6-4-5",
            "--3-5----",
            "-7----5-8",
            "9-1-8-7-2",
            "3-5----4-",
            "----4-9--",
            "8-9-7--2-",
            "-2-3-9--4",
          ],
          solution: [
            "156947238",
            "782163495",
            "493258176",
            "274631589",
            "961485732",
            "385792641",
            "537842916",
            "849576321",
            "621319854",
          ],
        },
        {
          board: [
            "--9748---",
            "7--------",
            "-2-1-9---",
            "---6-2-8-",
            "-8-4-1-6-",
            "-3-9-5---",
            "---8-3-2-",
            "--------4",
            "---5-69--",
          ],
          solution: [
            "519748632",
            "783652419",
            "426139875",
            "354682197",
            "287419563",
            "961375284",
            "175863924",
            "892517346",
            "634294751",
          ],
        },
        {
          board: [
            "-2-6-8---",
            "58---97--",
            "----4----",
            "37----5--",
            "6-------4",
            "--8----13",
            "----2----",
            "--98---36",
            "---3-6-9-",
          ],
          solution: [
            "123678945",
            "584239761",
            "967145328",
            "372461589",
            "691583274",
            "458792613",
            "836924157",
            "219857436",
            "745316892",
          ],
        },
      ];

      window.onload = function () {
        document
          .getElementById("start-game-btn")
          .addEventListener("click", startGame);
        document
          .getElementById("back-to-instructions-btn")
          .addEventListener("click", showInstructions);
        document
          .getElementById("play-again-btn")
          .addEventListener("click", startGame);
      };

      function startGame() {
        // Hide other screens and show the game
        document.getElementById("welcome-screen").style.display = "none";
        document.getElementById("win-screen").style.display = "none";
        document.getElementById("game-container").style.display = "block";

        // Reset errors for a new game
        errors = 0;
        document.getElementById("errors").innerText = errors;

        // Pick a new random puzzle
        const randomIndex = Math.floor(Math.random() * puzzleData.length);
        const selectedPuzzle = puzzleData[randomIndex];
        board = selectedPuzzle.board;
        solution = selectedPuzzle.solution;

        setGame();
      }

      // NEW: Function to show instructions
      function showInstructions() {
        document.getElementById("game-container").style.display = "none";
        document.getElementById("welcome-screen").style.display = "block";
      }

      function setGame() {
        document.getElementById("board").innerHTML = "";
        document.getElementById("digits").innerHTML = "";
        tilesToFill = 0;

        for (let i = 1; i <= 9; i++) {
          let number = document.createElement("div");
          number.id = i;
          number.innerText = i;
          number.addEventListener("click", function () {
            if (numSelected) numSelected.classList.remove("number-selected");
            numSelected = this;
            numSelected.classList.add("number-selected");
          });
          number.classList.add("number");
          document.getElementById("digits").appendChild(number);
        }

        for (let r = 0; r < 9; r++) {
          for (let c = 0; c < 9; c++) {
            let tile = document.createElement("div");
            tile.id = `${r}-${c}`;
            if (board[r][c] !== "-") {
              tile.innerText = board[r][c];
              tile.classList.add("tile-start");
            } else {
              tilesToFill++;
              tile.addEventListener("click", function () {
                if (numSelected) {
                  if (this.innerText !== "") return;
                  let coords = this.id.split("-");
                  let r_t = parseInt(coords[0]),
                    c_t = parseInt(coords[1]);
                  if (solution[r_t][c_t] === numSelected.id) {
                    this.innerText = numSelected.id;
                    tilesToFill--;
                    if (tilesToFill === 0) {
                      setTimeout(handleWin, 100); // MODIFIED: Call handleWin on victory
                    }
                  } else {
                    errors++;
                    document.getElementById("errors").innerText = errors;
                  }
                }
              });
            }
            if (r === 2 || r === 5) tile.classList.add("horizontal-line");
            if (c === 2 || c === 5) tile.classList.add("vertical-line");
            tile.classList.add("tile");
            document.getElementById("board").append(tile);
          }
        }
      }

      // NEW: Function to handle the win state
      function handleWin() {
        document.getElementById("game-container").style.display = "none";
        document.getElementById("win-screen").style.display = "block";
      }
    </script>
  </body>
</html>